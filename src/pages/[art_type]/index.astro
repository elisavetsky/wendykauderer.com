---
// Astro
import { getCollection } from 'astro:content';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {

   // import all non-draft artwork
   const artworkEntries = await getCollection('artwork', ({data}) => !data.draft);

   // sort entries from latest to oldest
   const sortedEntries = artworkEntries.sort((a, b) => Date.parse(b.data.date) - Date.parse(a.data.date));

   return sortedEntries.map((entry) => {

      // filter entries by art_type from the URL param
      const entriesByArtType = sortedEntries.filter((sortedEntry) => sortedEntry.data.art_type === entry.data.art_type )

      return {
         params: { 
            art_type: entry.data.art_type,
            slug: entry.slug
         }, 
         props: { 
            entries: entriesByArtType,
         },
      }
   });
}

// 2. For your template, you can get the entry directly from the prop
const { entries } = Astro.props;
const params = Astro.params;

// import utils
import { titleCase } from "../../utils/textTools.js"

// import layout
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArtworkGridLayout from "../../layouts/ArtworkGridLayout.astro";

// import components
import SectionHero from "../../components/SectionHero.astro";
---

<BaseLayout pageTitle={`${titleCase(params.art_type)}s`}>
   <SectionHero 
      title={`${titleCase(params.art_type)}s`} 
   />
   
   <section>
      <ArtworkGridLayout artwork={entries} />
   </section>
</BaseLayout>
