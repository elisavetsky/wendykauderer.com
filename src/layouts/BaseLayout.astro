--- 
import { getEntry } from "astro:content";
import { Image } from "astro:assets";

// Expose site configuration for CMS
import * as SitewideConfig from "../configuration/SitewideConfig.md";

//  import view transitions
import { ViewTransitions } from 'astro:transitions';

// import components
import MainFlexLayout from "./MainFlexLayout.astro";

// import FALLBACK ogImage
const featuredArtwork = await getEntry('settings', 'main-hero');

// import css
import "inter-ui/inter.css";
import '../styles/main.css'

const { pageTitle, ogTitle, ogDescription, ogImage, blurredBg, options } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" class="" transition:animate="fade">
	<head>
		<!-- // /////////////////////////////////////////////////
   		// WHENEVER VIEW TRANSITIONS API IS WIDELY AVAILABLE, TRY SPA Mode
   		// ///////////////////////////////////////////////// -->
		<ViewTransitions fallback="swap" />

		<!-- Global meta tags -->
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Esssential meta tags -->
		<title>{`${SitewideConfig.frontmatter.site_name} - ${pageTitle}`}</title>
		<meta name="description" content={SitewideConfig.frontmatter.site_description}>

		<!-- SEO -->
		<meta property="og:title" content={ogTitle}>
		<meta property="og:description" content={ogDescription}>
		<meta property="og:image" content={ogImage || featuredArtwork.data.image.src}>
		<meta property="og:url" content={`https://wendykauderer.com${Astro.url.pathname}`}>

		<script is:inline>
			// Get theme 
			const theme = (() => {

if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
	return localStorage.getItem("theme");
}

if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
	window.localStorage.setItem("theme", "system");
	return "dark";
	
} else {
	window.localStorage.setItem("theme", "system");
	return "light";
}

})();

				if (theme === "light") {
				document.documentElement.classList.remove("dark");
				} else if (theme === "dark") {
					document.documentElement.classList.add("dark");
				} else if (theme === "system" ) {
					if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
						document.documentElement.classList.add("dark");
					} else {
						document.documentElement.classList.remove("dark");
					}
				}
			


			// Runs on view transitions navigation
			document.addEventListener('astro:after-swap', () => {
				
				// Get theme 
				const theme = (() => {

if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
	return localStorage.getItem("theme");
}

if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
	window.localStorage.setItem("theme", "system");
	return "dark";
	
} else {
	window.localStorage.setItem("theme", "system");
	return "light";
}

})();

				if (theme === "light") {
				document.documentElement.classList.remove("dark");
				} else if (theme === "dark") {
					document.documentElement.classList.add("dark");
				} else if (theme === "system" ) {
					if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
						document.documentElement.classList.add("dark");
					} else {
						document.documentElement.classList.remove("dark");
					}
				}
			})

			// window.localStorage.setItem("theme", theme);
		
			// /////////////////////////////////////////////////
			// WHENEVER VIEW TRANSITIONS API IS WIDELY AVAILABLE
			// /////////////////////////////////////////////////
			/*
			function setDarkMode() {
				if (localStorage.darkMode) {
					document.documentElement.dataset.dark = '';
				}
			};
		
			// Runs on initial navigation
			setDarkMode();
			// Runs on view transitions navigation
			document.addEventListener('astro:after-swap', setDarkMode);
			*/
		</script>

		<link
			rel="preload"
			href="/fonts/James-Arthur-Regular/james-arthur-regular.woff2"
			as="font"
			type="font/woff2"
			crossorigin=""
		/>

		<link
			rel="preload"
			href="/fonts/Southampton/southampton.woff2"
			as="font"
			type="font/woff2"
			crossorigin=""
		/>
		
		
	</head>
	<body class="flex flex-col min-h-screen relative bg-gray-100 dark:bg-zinc-800 duration-200">
		{blurredBg &&
			<Image src={blurredBg} quality={1} width={50} alt="" role="presentation" class="hidden pointer-events-none animate-bgFadeIn supports-filter:block absolute overflow-hidden object-cover w-full h-full blur-2xl opacity-20 saturate-200 contrast-75 dark:opacity-[0.25] dark:animate-bgFadeIn-dark" />
		}
		<MainFlexLayout>
			<slot />
		</MainFlexLayout>
		
	</body>
</html>

