---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import slugify from "@sindresorhus/slugify";

// get art type background
const artwork = await getCollection("artwork");

function getLatestOfArtType(artType, property) {
   const allPaintings = artwork.filter((entry) => entry.data.art_type === artType)
      .sort((a, b) => Date.parse(b.data.date) - Date.parse(a.data.date));
   
   // if nothing found, throw error
   if (allPaintings.length) {

      // return first image with specified artType
      const output = allPaintings[0].data.image;

      if (output) {
         return output;
      } else {
         throw new Error(`No property named "${artType}" found for "${artType}" art type`);
      }
   } else {
      console.warn(`No entries found for the specified art type: "${artType}"`);

      // return null if nothing is found so that app doesn't crash
      return null;
   }   
}

// art types array
const artTypes = [
   { 
      route: "/painting", 
      label: "Paintings", 
      image: getLatestOfArtType("painting", "image"), 
      image_alt: getLatestOfArtType("painting", "image_alt") 
   },
   { 
      route: "/drawing", 
      label: "Drawings",
      image: getLatestOfArtType("drawing", "image"), 
      image_alt: getLatestOfArtType("drawing", "image_alt") 
   },
   { 
      route: "/sculpture", 
      label: "Sculptures",
      image: getLatestOfArtType("sculpture", "image"), 
      image_alt: getLatestOfArtType("sculpture", "image_alt")
   }
]

const props = Astro.props;
const { pathname } = Astro.url;

const commonClasses = "group absolute z-10 backdrop-blur-lg flex justify-center items-center w-full h-full rounded-full p-1 transition-all decoration-2 underline-offset-4"
---

{artTypes.map(({route, label, image, image_alt}) => {
   return (
      <li class={`relative w-24 h-24 mr-3 mb-3 rounded-full border-2 border-black/10 dark:border-white/10`}>
         <a 
            href={`${route}`} 
            class={`
               ${commonClasses} shadow-black/30 dark:shadow-black 
               ${pathname === `/${slugify(route)}` 
                  ? "backdrop-saturate-100 bg-white/30 !decoration-inherit shadow-md dark:bg-black/30 dark:backdrop-brightness-125" 
                  : `${pathname.includes("/", 1) 
                     ? "bg-transparent" 
                     : "bg-white/50 dark:bg-black/50"} shadow-sm hover:underline hover:decoration-inherit hover:shadow-md hover:shadow-black/30 hover:bg-white/30 dark:hover:bg-black/30`
               }
            `}
         >
            <span class={`${pathname === `/${slugify(route)}` && "underline decoration-2"} decoration-inherit group-hover:decoration-2`}>{label}</span>
         </a>
         {
            // Return ArtTypes background image only if NOT on a single artwork page

            image && image_alt && !pathname.includes("/", 1) &&
            <Image
               src={image}
               alt=""
               role="presentation"
               quality={1}
               width={50}
               loading="eager"
               class="saturate-200 brightness-110 w-full h-full object-cover rounded-full"
            />
         }
      </li>
   )
})}
