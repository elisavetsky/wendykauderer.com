---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import slugify from "@sindresorhus/slugify";

// get art type background
const artwork = await getCollection("artwork");

function getLatestOfArtType(artType, property) {
   const allPaintings = artwork.filter((entry) => entry.data.art_type === artType)
      .sort((a, b) => Date.parse(b.data.date) - Date.parse(a.data.date));
   
   // if nothing found, throw error
   if (allPaintings.length) {

      // return first image with specified artType
      const output = allPaintings[0].data.image;

      if (output) {
         return output;
      } else {
         throw new Error(`No property named "${artType}" found for "${artType}" art type`);
      }
   } else {
      console.warn(`No entries found for the specified art type: "${artType}"`);

      // return null if nothing is found so that app doesn't crash
      return null;
   }   
}

// art types array
const artTypes = [
   { 
      route: "/painting", 
      label: "Paintings", 
      image: getLatestOfArtType("painting", "image"), 
      image_alt: getLatestOfArtType("painting", "image_alt") 
   },
   { 
      route: "/drawing", 
      label: "Drawings",
      image: getLatestOfArtType("drawing", "image"), 
      image_alt: getLatestOfArtType("drawing", "image_alt") 
   },
   { 
      route: "/sculpture", 
      label: "Sculptures",
      image: getLatestOfArtType("sculpture", "image"), 
      image_alt: getLatestOfArtType("sculpture", "image_alt")
   }
]

const props = Astro.props;
---

{artTypes.map(({route, label, image, image_alt}) => {
   return (
      <li class={`relative w-24 h-24 mr-3 mb-3 rounded-full`}>
         <a 
            href={`${route}`} 
            class={`absolute z-10 shadow-md backdrop-blur-md  flex justify-center items-center bg-white/60 w-full h-full rounded-full p-1 transition-all duration-300 decoration-2 underline-offset-4 hover:underline decoration-transparent hover:decoration-inherit motion-safe:hover:-translate-y-1 motion-safe:hover:translate-x-1 hover:backdrop-blur-md hover:bg-white/60 dark:shadow-zinc-900 dark:bg-zinc-950/50 dark:hover:bg-zinc-950/50 ${Astro.url.pathname === `/${slugify(route)}` ? "backdrop-saturate-200 translate-x-1 -translate-y-1 shadow-lg backdrop-blur-lg bg-slate-50/60 dark:bg-zinc-950/50" : "backdrop-saturate-50 hover:shadow-lg hover:backdrop-saturate-200"}`}
         >
            <span class="drop-shadow-white underline-offset-4 decoration-2 decoration-[inherit] hover:decoration-inherit dark:drop-shadow-sm">{label}</span>
         </a>
         {image && image_alt &&
            <Image
               src={image}
               alt={image_alt}
               quality={1}
               width={50}
               loading="eager"
               class="saturate-200 brightness-[1.1] w-full h-full object-cover rounded-full hover:blur-md"
            />
         }
      </li>
   )
})}
