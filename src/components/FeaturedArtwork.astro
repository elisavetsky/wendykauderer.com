---
// Astro
import { getCollection } from "astro:content";

// Expose site configuration for CMS
import { frontmatter } from "../configuration/SitewideConfig.md";
const featuredTitle = frontmatter.homepage_featured_section_title;

// import components
import ImageWrapper from "./ImageWrapper.astro";
import SectionTitle from "./SectionTitle.astro";
import ArtDetails from "./ArtDetails.astro";
import FullArtwork from "./FullArtwork.astro";

// import utils
import { truncateTextToPeriod } from "../utils/textTools.js";

// import Featured Artwork
const allFeaturedArtwork = await getCollection('artwork', ({data}) => {
   // prevent draft posts from showing in feature
   return data.draft !== true && data.featured === true;
});
const featuredArtwork = allFeaturedArtwork.sort((a, b) => {
   const latestToOldest = Date.parse(b.data.date) - Date.parse(a.data.date);

   return latestToOldest;
})

// const allArtwork = await Astro.glob("../pages/artwork/*.md");
// const featuredArtwork = allArtwork.filter((artwork) => artwork.data.featured === true);
---

<section class="py-10 m-auto max-w-screen-2xl">
   <SectionTitle title={featuredTitle} />
   <div class="w-full flex flex-col flex-wrap justify-between md:flex-row md:px-4 md:gap-4">
      {
         featuredArtwork.map((entry) => {
            return (
               <div class="mb-10 flex-auto basis-full md:basis-1/3 lg:basis-1/4 2xl:basis-1/5 last-of-type:mb-0">
                  <FullArtwork 
                     title={entry.data.title} 
                     date={entry.data.date}
                     artType={entry.data.art_type}
                     tags={entry.data.tags}
                     href={`${entry.collection}/${entry.slug}`}
                     images={entry.data.images[0]}
                     description={entry.data.description}
                  />
               </div>
               
            )
         })
      }
   </div>
</section>